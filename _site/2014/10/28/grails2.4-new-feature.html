<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print">
    <title>Xd216 Lab Blog</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Xd216的博客</h1>
        
        <a href="https://github.com/xd216" class="button"><small>Follow me on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">        
        <h1>
<a name="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages"><span class="octicon octicon-link"></span></a> 
grails2.4实用新特性 
        </h1>
<h3>添加资源的方便之门</h3>

<p>将资源文件放置在<code>/grails-app/assets/</code>目录下,不同资源分开,分别是<code>images</code>,<code>javascripts</code>,<code>stylesheets</code>三个子目录</p>

<p>gsp文件中引用资源只需如下:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;asset:javascript</span> <span class="na">src=</span><span class="s">&quot;application.js&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;asset:stylesheet</span> <span class="na">href=</span><span class="s">&quot;application.css&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;asset:image</span> <span class="na">src=</span><span class="s">&quot;grails_logo.png&quot;</span> <span class="na">height=</span><span class="s">&quot;60&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<h3>更好用的GORM子查询</h3>

<ul>
<li>嵌套子查询</li>
</ul>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="na">where</span><span class="o">{</span>
    <span class="n">firstname</span> <span class="k">in</span> <span class="n">where</span> <span class="o">{</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="o">}.</span><span class="na">firstname</span>
<span class="o">}.</span><span class="na">list</span><span class="o">()</span>
</code></pre></div>
<ul>
<li>Criteria 与 where 结合使用</li>
</ul>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="na">withCriteria</span><span class="o">{</span>
    <span class="n">notIn</span> <span class="s2">&quot;firstname&quot;</span><span class="o">,</span><span class="n">Person</span><span class="o">.</span><span class="na">where</span> <span class="o">{</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="o">}.</span><span class="na">firstname</span>
<span class="o">}</span>
</code></pre></div>
<ul>
<li>联合两个domain的相关查询</li>
</ul>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="n">employees</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="na">where</span> <span class="o">{</span>
    <span class="n">region</span><span class="o">.</span><span class="na">continent</span> <span class="k">in</span> <span class="o">[</span><span class="s1">&#39;APAC&#39;</span><span class="o">,</span> <span class="s2">&quot;EMEA&quot;</span><span class="o">]</span>
<span class="o">}.</span><span class="na">id</span><span class="o">()</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="n">Sale</span><span class="o">.</span><span class="na">where</span> <span class="o">{</span>
    <span class="n">employee</span> <span class="k">in</span> <span class="n">employees</span> <span class="o">&amp;&amp;</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">100000</span>
<span class="o">}.</span><span class="na">employee</span><span class="o">.</span><span class="na">list</span><span class="o">()</span>
</code></pre></div>
<ul>
<li>支持简单变量声明的别名进行查询</li>
</ul>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="na">where</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">em1</span> <span class="o">=</span> <span class="n">Employee</span>
    <span class="n">exists</span> <span class="n">Sale</span><span class="o">.</span><span class="na">where</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">Sale</span>
        <span class="kt">def</span> <span class="n">em2</span> <span class="o">=</span> <span class="n">employee</span>
        <span class="k">return</span> <span class="n">em2</span><span class="o">.</span><span class="na">id</span> <span class="o">==</span> <span class="n">em1</span><span class="o">.</span><span class="na">id</span>
    <span class="o">}.</span><span class="na">id</span><span class="o">()</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">()</span>
</code></pre></div>
<h3>支持异步处理请求</h3>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">def</span> <span class="n">ctx</span> <span class="o">=</span> <span class="n">startAsync</span><span class="o">()</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">start</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="nl">title:</span><span class="s2">&quot;The Stand&quot;</span><span class="o">).</span><span class="na">save</span><span class="o">()</span>
        <span class="n">render</span> <span class="nl">template:</span><span class="s2">&quot;books&quot;</span><span class="o">,</span> <span class="nl">model:</span><span class="o">[</span><span class="nl">books:</span><span class="n">Book</span><span class="o">.</span><span class="na">list</span><span class="o">()]</span>
        <span class="n">ctx</span><span class="o">.</span><span class="na">complete</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>参考 <code>http://grails.org/doc/latest/guide/single.html#async</code></p>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kn">import</span> <span class="nn">static</span> <span class="n">grails</span><span class="o">.</span><span class="na">async</span><span class="o">.</span><span class="na">Promises</span><span class="o">.*</span>
<span class="c1">//...</span>
<span class="kt">def</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">tasks</span> <span class="nl">books:</span> <span class="n">Book</span><span class="o">.</span><span class="na">async</span><span class="o">.</span><span class="na">list</span><span class="o">(),</span>
         <span class="nl">totalBooks:</span> <span class="n">Book</span><span class="o">.</span><span class="na">async</span><span class="o">.</span><span class="na">count</span><span class="o">(),</span>
         <span class="nl">otherValue:</span> <span class="o">{</span>
           <span class="c1">// do hard work</span>
         <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
        </section>

        <aside id="sidebar">


          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
