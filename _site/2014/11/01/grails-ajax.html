<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print">
	<link rel="icon" href="/images/page.ico">
    <title>Xd216 Lab Blog</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Xd216的博客</h1>
        
        <a href="https://github.com/xd216" class="button"><small>Follow me on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">        
        <h1>
<a name="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages"><span class="octicon octicon-link"></span></a> 
Grails中使用ajax异步获取数据 
        </h1>
<h2>异步表单,查询数据</h2>

<h4>页面中定义表单</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;g:formRemote</span>
     <span class="na">name=</span><span class="s">&quot;myForm&quot;</span>
     <span class="na">url=</span><span class="s">&quot;[controller: &#39;user&#39;, action: &#39;ajaxGetUsers&#39;]&quot;</span>
         <span class="na">update=</span><span class="s">&quot;message&quot;</span>
<span class="nt">&gt;</span>
     <span class="nt">&lt;g:select</span>
         <span class="na">class=</span><span class="s">&quot;form-control&quot;</span>
         <span class="na">name=</span><span class="s">&quot;rolename&quot;</span>
         <span class="na">from=</span><span class="s">&quot;${roles}&quot;</span>
         <span class="na">optionKey=</span><span class="s">&quot;id&quot;</span>
             <span class="na">noSelection=</span><span class="s">&quot;[&#39;&#39;:&#39;-按角色查询工号-&#39;]&quot;</span>
    <span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary&quot;</span> <span class="na">value=</span><span class="s">&quot;查询&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/g:formRemote &gt;</span>
</code></pre></div>
<h4><code>UserController</code>中定义查询方法</h4>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="n">ajaxGetUsers</span> <span class="o">=</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Role</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">rolename</span><span class="o">.</span><span class="na">toInteger</span><span class="o">())</span>
        <span class="kt">def</span> <span class="n">users</span> <span class="o">=</span> <span class="n">role</span><span class="o">?.</span><span class="na">users</span>
        <span class="n">println</span> <span class="n">users</span>
        <span class="nf">render</span><span class="o">(</span><span class="nl">template:</span><span class="s2">&quot;userlists&quot;</span><span class="o">,</span><span class="nl">model:</span><span class="o">[</span><span class="nl">msg:</span><span class="n">users</span><span class="o">])</span>
<span class="o">}</span>
</code></pre></div>
<h4>上文表单所在页面内,定义一个用于更新数据的<code>DIV</code></h4>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;g:render</span> <span class="na">template=</span><span class="s">&quot;userlists&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h4>在<code>/view/user</code>目录下创建一个template文件:<code>_userlists.gsp</code></h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">格式可以自己定义
<span class="nt">&lt;g:each</span> <span class="na">in=</span><span class="s">&quot;${msg}&quot;</span> <span class="na">var=</span><span class="s">&quot;m&quot;</span><span class="nt">&gt;</span>
    ${m}<span class="nt">&lt;br/&gt;</span>
<span class="nt">&lt;/g:each&gt;</span>
</code></pre></div>
<h2>异步下拉菜单查询数据</h2>

<h4>下拉菜单</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;g:select</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span>
      <span class="na">name=</span><span class="s">&quot;username&quot;</span> 
      <span class="na">from=</span><span class="s">&quot;${users}&quot;</span>
      <span class="na">optionKey=</span><span class="s">&quot;id&quot;</span>
          <span class="na">noSelection=</span><span class="s">&quot;[&#39;&#39;:&#39;-按姓名查询信息-&#39;]&quot;</span>
          <span class="na">onchange=</span><span class="s">&quot;${remoteFunction(controller:&#39;user&#39;,action: &#39;userinfo&#39;,</span>
<span class="s">          update: &#39;userinfo&#39;,</span>
<span class="s">          params: &#39;\&#39;id=\&#39; + this.value&#39;)}&quot;</span>
<span class="nt">/&gt;</span>
</code></pre></div>
<h4><code>UserCtroller</code>中定义查询方法</h4>
<div class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="kt">def</span> <span class="nf">userinfo</span><span class="o">(){</span>
        <span class="n">println</span> <span class="n">params</span>
        <span class="kt">def</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">params</span><span class="o">.</span><span class="na">id</span><span class="o">)</span>
        <span class="n">render</span><span class="o">(</span><span class="nl">template:</span><span class="s2">&quot;userinfo&quot;</span><span class="o">,</span><span class="nl">model:</span><span class="o">[</span><span class="nl">user:</span><span class="n">user</span><span class="o">])</span>
    <span class="o">}</span>
</code></pre></div>
<h4>更新数据</h4>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;userinfo&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;g:render</span> <span class="na">template=</span><span class="s">&quot;userlists&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<h4>定义模版文件<code>view/user/_userinfo.gsp</code></h4>
<div class="highlight"><pre><code class="language-html" data-lang="html">姓名:${user.name}<span class="nt">&lt;br/&gt;</span>
工号:${user.jobId}<span class="nt">&lt;br/&gt;</span>
</code></pre></div>
        </section>

        <aside id="sidebar">


          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
